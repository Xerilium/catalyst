---
id: github-integration
title: GitHub Integration
author: "@flanakin"
description: "This document defines the what and why of the GitHub Integration feature for architects and engineers. The document is generated by Catalyst AI and reviewed by the feature PM."
dependencies:
  - error-handling
---

<!-- markdownlint-disable single-title -->

# Feature: GitHub Integration

## Problem

Catalyst requires programmatic GitHub operations to enable issue-driven workflows, PR automation, and repository configuration management without manual intervention or brittle string parsing.

## Goals

- Provide reliable GitHub operations wrapper for issues, PRs, comments, and repository settings
- Enable testable GitHub integrations through dependency injection
- Deliver consistent, structured error handling with actionable remediation guidance
- Support issue-driven workflows for project initialization and blueprint creation
- Enable PR automation for comment threads, feature detection, and review workflows
- Support repository configuration for branch protection, labels, and settings

Explicit non-goals:

- Real-time webhooks or event subscriptions
- GitHub App development or OAuth token management
- GitHub Actions workflow generation or CI/CD pipeline management
- Organization-level administration (teams, enterprise settings, billing)

## Scenario

- As a **Catalyst Developer**, I need to fetch GitHub issues with comments so that I can initialize projects from issue descriptions
  - Outcome: Project initialization extracts complete context from GitHub issues including all discussion threads

- As a **Catalyst Developer**, I need to create and reply to GitHub issues so that I can generate initialization issues and respond to user questions programmatically
  - Outcome: Issue creation and comment workflows complete successfully with proper error handling

- As a **Catalyst Developer**, I need to find and reply to PR comment threads so that I can implement PR review automation
  - Outcome: PR automation identifies unresolved threads, posts replies, and tracks conversation state

- As a **Catalyst Developer**, I need to configure repository settings so that I can set up branch protection, labels, and other repository policies during initialization
  - Outcome: Repository configuration applies consistently across all Catalyst projects

- As a **Catalyst Developer**, I need a simple CLI interface to GitHub operations so that I can invoke GitHub operations from shell scripts and playbooks without complex node commands
  - Outcome: GitHub operations invocable via `catalyst-github <operation>` instead of `node node_modules/@xerilium/catalyst/playbooks/scripts/github.js`

- As a **Test Author**, I need to mock GitHub operations so that I can test playbook logic without live GitHub API calls
  - Outcome: Unit tests run reliably without GitHub CLI installed or authentication configured

- As a **Framework User**, I need clear error messages when GitHub operations fail so that I can resolve authentication, network, or permission issues quickly
  - Outcome: Error messages indicate specific failure causes with step-by-step remediation instructions

## Success Criteria

- All GitHub operations return structured results with explicit error types
- Unit tests achieve code coverage target per engineering.md standards
- GitHub operations testable without live CLI using dependency injection
- Error messages provide actionable guidance for all failure modes
- Repository detection works dynamically without hard-coded values
- CLI interface provides simple, memorable command structure

## Design principles

- **Explicit over implicit**
  > Return structured result types with clear success/failure states. Callers must know exactly what happened and why without inspecting logs or parsing error strings.

- **Test without external dependencies**
  > Design for dependency injection to enable testing business logic without GitHub CLI installed or network access. All GitHub operations must be mockable.

- **Fail with context**
  > When operations fail, provide specific error types with actionable remediation steps. Users must know whether the issue is authentication, network, permissions, or data format along with how to fix it.

## Requirements

### Functional Requirements

**Issue Operations:**

- **FR-1**: System MUST provide issue operations
  - FR-1.1: Query operations
    - FR-1.1.1: Find issues by title pattern and optional repository (`catalyst-github issue find <pattern>`)
    - FR-1.1.2: Get issue body by issue number (`catalyst-github issue get <number>`)
    - FR-1.1.3: Get issue with all comments and metadata (`catalyst-github issue get <number> --with-comments`)
    - FR-1.1.4: List issues with filtering by state, labels, assignee, author (`catalyst-github issue list --state=<state> --label=<label>`)
  - FR-1.2: Modification operations
    - FR-1.2.1: Create issues with title, body, labels, and assignees (`catalyst-github issue create --title=<title> --body=<body>`)
    - FR-1.2.2: Update issue properties including title, body, state, labels, assignees (`catalyst-github issue update <number> --title=<title>`)
    - FR-1.2.3: Add comments to issues (`catalyst-github issue comment <number> <body>`)
    - FR-1.2.4: Close issues with optional close reason (`catalyst-github issue close <number> --reason=<reason>`)
  - FR-1.3: Template operations (internal functions, not CLI commands)
    - FR-1.3.1: Read issue templates from `templates/issues/` directory
    - FR-1.3.2: Parse frontmatter for issue metadata (labels, assignees, milestones)
    - FR-1.3.3: Replace placeholders in template body with provided values

**Pull Request Operations:**

- **FR-2**: System MUST provide PR operations
  - FR-2.1: Query operations
    - FR-2.1.1: Find PRs by search pattern including title, labels, author (`catalyst-github pr find <pattern>`)
    - FR-2.1.2: Get PR metadata including title, body, state, branch names (`catalyst-github pr get <number>`)
    - FR-2.1.3: Detect feature ID from PR branch name or body (`catalyst-github pr get-feature <number>`)
    - FR-2.1.4: List PRs with filtering by state, labels, base branch (`catalyst-github pr list --state=<state>`)
  - FR-2.2: Comment operations
    - FR-2.2.1: Get PR comments (includes conversation and review threads) (`catalyst-github pr comments <number>`)
    - FR-2.2.2: Add comment to PR conversation (`catalyst-github pr comment <number> <body>`)
    - FR-2.2.3: Find unresolved comment threads needing replies (`catalyst-github pr threads <number>`)
    - FR-2.2.4: Reply to comment thread (`catalyst-github pr reply <pr-number> <thread-id> <body>`)
      - System identifies thread root comment ID from thread ID
      - Wrapper posts reply to the thread root, creating threaded conversation
  - FR-2.3: Review operations
    - FR-2.3.1: Get all reviews on PR with status and comments (`catalyst-github pr reviews <number>`)
    - FR-2.3.2: Submit PR review with approve, request changes, or comment status (`catalyst-github pr review <number> --status=<status>`)
    - FR-2.3.3: Dismiss stale reviews (`catalyst-github pr dismiss-review <pr-number> <review-id>`)

**Repository Operations:**

- **FR-3**: System MUST provide repository operations
  - FR-3.1: Detection operations
    - FR-3.1.1: Get repository information including owner, name, default branch, and description (`catalyst-github repo info`)
    - FR-3.1.2: Get current repository from `gh` context when not in git directory
    - FR-3.1.3: Support `--json` flag for structured output
  - FR-3.2: Settings operations
    - FR-3.2.1: Configure branch protection rules for PRs, reviews, status checks (`catalyst-github repo protect <branch>`)
    - FR-3.2.2: Create and manage repository labels (`catalyst-github repo label create <name> --color=<color>`)
    - FR-3.2.3: Set repository properties including description, homepage, topics (`catalyst-github repo set-properties --description=<desc>`)
    - FR-3.2.4: Configure merge settings for squash, merge, rebase options (`catalyst-github repo set-merge-settings`)

**Authentication and Setup:**

- **FR-4**: System MUST provide authentication operations
  - FR-4.1: Authenticate with GitHub (`catalyst-github auth`)
  - FR-4.2: Support `--force` flag to re-authenticate when already signed in
  - FR-4.3: Provide clear error messages when CLI not installed (with installation instructions from https://cli.github.com/)
  - FR-4.4: Check authentication status and return success/failure without prompting

**Dependency Injection:**

- **FR-5**: System MUST support dependency injection for testing
  - FR-5.1: Define abstract interface for all GitHub operations (contract defining all methods)
  - FR-5.2: Implement concrete adapter using GitHub CLI and/or API as appropriate per operation
  - FR-5.3: Allow callers to provide alternative implementations via constructor injection
  - FR-5.4: Provide mock implementation for testing that implements full interface

**Error Handling:**

- **FR-6**: System MUST return structured results with explicit error types
  - FR-6.1: Define error hierarchy: `GitHubError` (base), `GitHubAuthError`, `GitHubNotFoundError`, `GitHubNetworkError`, `GitHubRateLimitError`, `GitHubPermissionError`
  - FR-6.2: Return result objects with structure: `{ success: boolean, data: T | null, error: GitHubError | null }`
  - FR-6.3: Include actionable remediation guidance in all error messages with specific steps
  - FR-6.4: Distinguish transient errors (network, rate limit - should retry) from permanent errors (not found, auth - user action required)
  - FR-6.5: Provide programmatic error resolution where possible (e.g., installation helpers)

**CLI Interface:**

- **FR-7**: System MUST provide CLI interface for all operations
  - FR-7.1: Invoke via `catalyst-github <operation>` format with intuitive command names
  - FR-7.2: Support all GitHub operations defined in FR-1 through FR-4
  - FR-7.3: Output JSON for structured data, plain text for simple values
  - FR-7.4: Exit with code 0 on success, non-zero on failure
  - FR-7.5: Write errors to stderr, data to stdout
  - FR-7.6: Support `--help` flag for all commands with usage examples

### Non-functional requirements

- **NFR-1**: Reliability
  - All GitHub operations MUST handle errors gracefully without throwing unhandled exceptions
  - System MUST distinguish transient errors (network, rate limit) from permanent errors (not found, auth)
  - GitHub CLI/API calls MUST have reasonable timeouts to prevent hanging
  - System MUST retry transient failures with exponential backoff

- **NFR-2**: Performance
  - GitHub operations SHOULD complete within 5 seconds under normal conditions
  - System MUST use efficient commands (avoid multiple calls when one suffices)
  - Large result sets MUST use pagination to avoid memory exhaustion
  - System SHOULD cache repository metadata to reduce redundant API calls

- **NFR-3**: Testability
  - Code coverage target per `.xe/engineering.md` standards
  - All business logic MUST be testable without GitHub CLI installed
  - Tests MUST NOT require network access or live GitHub authentication
  - Mock implementation MUST support all interface operations

- **NFR-4**: Observability
  - GitHub operations SHOULD log command/API execution for debugging
  - Error types MUST be distinguishable programmatically (not just by message text)
  - Callers MUST be able to access raw CLI/API output for advanced debugging
  - System SHOULD provide structured logging with correlation IDs

- **NFR-5**: Usability
  - CLI commands MUST be intuitive and follow consistent naming patterns
  - Error messages MUST provide specific, actionable remediation steps
  - Help text MUST include examples for common operations
  - System MUST detect common misconfigurations and provide guidance

## Key Entities

Entities owned by this feature:

- **GitHubClient Interface**: Abstract contract defining all GitHub operations with structured inputs/outputs and error handling
- **GitHubAdapter**: Concrete implementation using `gh` CLI and/or REST API as appropriate
- **GitHubError Types**: Structured error hierarchy for different failure modes
- **GitHub Result Types**: Structured response objects for issues, PRs, comments, reviews, repositories
- **CLI Command Interface**: Simple command structure for invoking operations from shell scripts

Entities from other features:

- None (foundation feature with no dependencies)

Inputs:

- **Environment**: GitHub CLI (`gh`) installed and authenticated, or GitHub token available
- **Git Repository**: Working directory in a git repository with remote configured
- **Command Parameters**: Operation-specific parameters (issue numbers, PR numbers, search patterns, configuration values)
- **Templates**: Issue templates from `templates/issues/` directory

Outputs:

- **Structured Results**: Objects with `success`, `data`, `error` fields
- **Error Messages**: Actionable error messages with remediation steps and links to documentation
- **CLI JSON Output**: Machine-readable JSON for script consumption
- **CLI Text Output**: Human-readable text for interactive use

## Dependencies

**External Tools:**
- GitHub CLI (`gh` version 2.0+) OR GitHub personal access token with appropriate scopes
- Git configured with remote repository URL

**Internal Dependencies:**
- Node.js runtime with TypeScript support
- `child_process` module for CLI execution (if using `gh`)
- HTTP client for API calls (if not using `gh`)
- `fs` and `path` modules for file system operations

**No Feature Dependencies:**
- This is the first feature in Tier 1.3 (Workflow Engine) with no upstream dependencies
